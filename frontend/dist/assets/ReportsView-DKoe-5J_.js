import{q as I,c as d,p as s,l as i,s as N,r as n,m as B,o as m,a,b as R,t as V,e as b,v as C,F as D,j as _,x as w,A}from"./index-BFw-5ybC.js";import{u as M}from"./trips-6R3CgoW9.js";import{u as U}from"./useToast-s_LeXPXK.js";import{P}from"./PageHeader-BOipoClw.js";import{T as j}from"./TabBar-CHoA4lWA.js";import{D as G}from"./DataTable-Bv1DpfSK.js";import{S as E}from"./StatusBadge-HXGXxIt_.js";import{B as L}from"./BaseModal-BqmQ-p03.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"form-group"},z={class:"grid-2"},H={class:"form-group"},Q=["value"],J={class:"form-group"},K=["disabled"],O={__name:"ReportsView",setup(W){const v=M(),c=U(),f=n(!0),p=n([]),g=n([]),u=n(""),o=n(!1),r=A({reportName:"",tripId:"",statusFilter:""}),k=[{value:"",label:"All",icon:"bi bi-list-ul"},{value:"submitted",label:"Submitted",icon:"bi bi-send"},{value:"approved",label:"Approved",icon:"bi bi-check-circle"},{value:"rejected",label:"Rejected",icon:"bi bi-x-circle"}],x=[{key:"report_name",label:"Report Name",sortable:!0},{key:"trip_name",label:"Trip"},{key:"status",label:"Status",sortable:!0},{key:"created_at",label:"Created",sortable:!0}],S=B(()=>u.value?p.value.filter(l=>l.status===u.value):p.value);function T(l){return l?new Date(l).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}):"-"}async function F(){try{await N.createReport({reportName:r.reportName,tripId:r.tripId||void 0,statusFilter:r.statusFilter||void 0}),o.value=!1,r.reportName="",r.tripId="",r.statusFilter="",c.success("Report generated"),await y()}catch(l){c.error(l.message)}}async function y(){try{p.value=await N.getReports()}catch(l){console.error(l)}}return I(async()=>{await Promise.all([y(),v.fetchTrips()]),g.value=v.trips,f.value=!1}),(l,e)=>(m(),d("div",null,[s(P,{title:"Reports",icon:"bi bi-file-earmark-text-fill",subtitle:"Generate and view expense reports"},{default:i(()=>[a("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=t=>o.value=!0)},[...e[7]||(e[7]=[a("i",{class:"bi bi-plus-lg"},null,-1),R(" New Report ",-1)])])]),_:1}),s(j,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),tabs:k},null,8,["modelValue"]),s(G,{columns:x,data:S.value,loading:f.value},{"cell-status":i(({value:t})=>[s(E,{status:t},null,8,["status"])]),"cell-created_at":i(({value:t})=>[R(V(T(t)),1)]),_:1},8,["data","loading"]),s(L,{modelValue:o.value,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value=t),title:"Generate Report",size:"md"},{footer:i(()=>[a("button",{class:"btn btn-outline",onClick:e[5]||(e[5]=t=>o.value=!1)},"Cancel"),a("button",{class:"btn btn-primary",onClick:F,disabled:!r.reportName.trim()},"Generate",8,K)]),default:i(()=>[a("div",q,[e[8]||(e[8]=a("label",{class:"form-label"},"Report Name *",-1)),b(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>r.reportName=t),type:"text",class:"form-input",placeholder:"e.g. Q4 Expense Summary"},null,512),[[C,r.reportName]])]),a("div",z,[a("div",H,[e[10]||(e[10]=a("label",{class:"form-label"},"Trip",-1)),b(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>r.tripId=t),class:"form-input"},[e[9]||(e[9]=a("option",{value:""},"All trips",-1)),(m(!0),d(D,null,_(g.value,t=>(m(),d("option",{key:t.id,value:t.id},V(t.tripName||t.trip_name),9,Q))),128))],512),[[w,r.tripId]])]),a("div",J,[e[12]||(e[12]=a("label",{class:"form-label"},"Status Filter",-1)),b(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>r.statusFilter=t),class:"form-input"},[...e[11]||(e[11]=[a("option",{value:""},"All",-1),a("option",{value:"approved"},"Approved only",-1),a("option",{value:"pending"},"Pending only",-1)])],512),[[w,r.statusFilter]])])])]),_:1},8,["modelValue"])]))}},oe=$(O,[["__scopeId","data-v-700a2375"]]);export{oe as default};
