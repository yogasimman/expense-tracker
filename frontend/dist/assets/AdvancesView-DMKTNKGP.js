import{u as U,q as $,c as A,p as i,l as n,f as m,a,t as C,b as p,d as V,r,m as P,i as I,o as k,w as j,e as q,v as z}from"./index-BFw-5ybC.js";import{u as E}from"./advances-Bs1wD2gA.js";import{u as F}from"./useToast-s_LeXPXK.js";import{P as L}from"./PageHeader-BOipoClw.js";import{T as H}from"./TabBar-CHoA4lWA.js";import{D as G}from"./DataTable-Bv1DpfSK.js";import{S as J}from"./StatusBadge-HXGXxIt_.js";import{B as w}from"./BaseModal-BqmQ-p03.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"amount"},Q={class:"row-actions"},W=["onClick"],X=["onClick"],Y={key:0,class:"bulk-actions"},Z={class:"bulk-count"},ee={class:"form-group"},te=["disabled"],ae={__name:"AdvancesView",setup(le){const s=E(),f=U(),d=F(),v=r(""),o=r([]),c=r(!1),b=r(!1),u=r(""),g=r(null),y=r(null),x=[{value:"",label:"All",icon:"bi bi-list-ul"},{value:"pending",label:"Pending",icon:"bi bi-hourglass-split"},{value:"approved",label:"Approved",icon:"bi bi-check-circle"},{value:"rejected",label:"Rejected",icon:"bi bi-x-circle"}],T=[{key:"amount",label:"Amount",sortable:!0},{key:"currency",label:"Currency"},{key:"paid_through",label:"Paid Through",sortable:!0},{key:"reference",label:"Reference"},{key:"trip_name",label:"Trip"},{key:"status",label:"Status",sortable:!0}],D=P(()=>v.value?s.advances.filter(l=>l.status===v.value):s.advances);function R(l){y.value=l,b.value=!0}function N(l){g.value=l,u.value="",c.value=!0}async function S(){try{await s.deleteAdvance(y.value.id),b.value=!1,d.success("Advance deleted")}catch(l){d.error(l.message)}}async function B(){try{await s.approveAdvances(o.value.map(l=>l.id)),o.value=[],d.success("Advances approved"),s.fetchAdvances()}catch(l){d.error(l.message)}}async function M(){try{if(g.value)await s.rejectAdvance(g.value.id,u.value);else{for(const l of o.value)await s.rejectAdvance(l.id,u.value);o.value=[]}c.value=!1,g.value=null,u.value="",d.success("Advance(s) rejected"),s.fetchAdvances()}catch(l){d.error(l.message)}}return $(()=>s.fetchAdvances()),(l,e)=>{const _=I("router-link");return k(),A("div",null,[i(L,{title:"Advances",icon:"bi bi-credit-card-fill",subtitle:"Manage cash advance requests"},{default:n(()=>[i(_,{to:"/app/advances/new",class:"btn btn-primary"},{default:n(()=>[...e[8]||(e[8]=[a("i",{class:"bi bi-plus-lg"},null,-1),p(" New Advance ",-1)])]),_:1})]),_:1}),i(H,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),tabs:x},null,8,["modelValue"]),i(G,{columns:T,data:D.value,loading:m(s).loading,selectable:m(f).isAdmin&&v.value==="pending",selectableFilter:t=>t.status==="pending",selected:o.value,"onUpdate:selected":e[1]||(e[1]=t=>o.value=t)},{"cell-status":n(({value:t})=>[i(J,{status:t},null,8,["status"])]),"cell-amount":n(({row:t})=>[a("span",O,"₹"+C(Number(t.amount).toLocaleString("en-IN")),1)]),actions:n(({row:t})=>[a("div",Q,[t.status==="pending"&&!m(f).isAdmin?(k(),A("button",{key:0,class:"btn btn-ghost btn-sm text-danger",onClick:j(h=>R(t),["stop"])},[...e[9]||(e[9]=[a("i",{class:"bi bi-trash"},null,-1)])],8,W)):V("",!0),m(f).isAdmin&&t.status==="pending"?(k(),A("button",{key:1,class:"btn btn-ghost btn-sm text-danger",onClick:j(h=>N(t),["stop"])},[...e[10]||(e[10]=[a("i",{class:"bi bi-x-circle"},null,-1)])],8,X)):V("",!0)])]),_:1},8,["data","loading","selectable","selectableFilter","selected"]),m(f).isAdmin&&o.value.length?(k(),A("div",Y,[a("span",Z,C(o.value.length)+" selected",1),a("button",{class:"btn btn-success btn-sm",onClick:B},[...e[11]||(e[11]=[a("i",{class:"bi bi-check-lg"},null,-1),p(" Approve",-1)])]),a("button",{class:"btn btn-danger btn-sm",onClick:e[2]||(e[2]=t=>c.value=!0)},[...e[12]||(e[12]=[a("i",{class:"bi bi-x-lg"},null,-1),p(" Reject",-1)])])])):V("",!0),i(w,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),title:"Reject Advance",size:"sm"},{footer:n(()=>[a("button",{class:"btn btn-outline",onClick:e[4]||(e[4]=t=>c.value=!1)},"Cancel"),a("button",{class:"btn btn-danger",onClick:M,disabled:!u.value.trim()},"Reject",8,te)]),default:n(()=>[a("div",ee,[e[13]||(e[13]=a("label",{class:"form-label"},"Reason for rejection",-1)),q(a("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>u.value=t),class:"form-input",rows:"3",placeholder:"Enter reason..."},null,512),[[z,u.value]])])]),_:1},8,["modelValue"]),i(w,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=t=>b.value=t),title:"Delete Advance",size:"sm"},{footer:n(()=>[a("button",{class:"btn btn-outline",onClick:e[6]||(e[6]=t=>b.value=!1)},"Cancel"),a("button",{class:"btn btn-danger",onClick:S},"Delete")]),default:n(()=>{var t;return[a("p",null,[e[14]||(e[14]=p("Are you sure you want to delete this advance of ",-1)),a("strong",null,"₹"+C(Number(((t=y.value)==null?void 0:t.amount)||0).toLocaleString("en-IN")),1),e[15]||(e[15]=p("?",-1))])]}),_:1},8,["modelValue"])])}}},be=K(ae,[["__scopeId","data-v-6a6583be"]]);export{be as default};
