import{u as $,q as I,c as x,p as i,l as n,f as v,a as l,t as k,b,d as C,r,m as P,i as z,o as y,w as V,e as F,v as L}from"./index-C6ZveIad.js";import{u as h}from"./expenses-qkkFQHoE.js";import{u as q}from"./useToast-DtJ4WnZ9.js";import{P as H}from"./PageHeader-DIKsNb4s.js";import{T as G}from"./TabBar-BV6PNCGJ.js";import{D as J}from"./DataTable-DtQj_e2y.js";import{S as K}from"./StatusBadge-CnPGBlg1.js";import{B as w}from"./BaseModal-CFzfHryr.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"amount"},W={class:"row-actions"},X=["onClick"],Y=["onClick"],Z={key:0,class:"bulk-actions"},ee={class:"bulk-count"},te={class:"form-group"},se=["disabled"],le={__name:"ExpensesView",setup(ae){const a=h(),f=$(),d=q(),p=r(""),o=r([]),c=r(!1),m=r(!1),u=r(""),g=r(null),E=r(null),j=[{value:"",label:"All",icon:"bi bi-list-ul"},{value:"pending",label:"Pending",icon:"bi bi-hourglass-split"},{value:"approved",label:"Approved",icon:"bi bi-check-circle"},{value:"rejected",label:"Rejected",icon:"bi bi-x-circle"}],D=[{key:"expense_title",label:"Title",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"category_name",label:"Category",sortable:!0},{key:"trip_name",label:"Trip"},{key:"status",label:"Status",sortable:!0},{key:"date",label:"Date",sortable:!0}],T=P(()=>p.value?a.expenses.filter(s=>s.status===p.value):a.expenses);function A(s){return s?new Date(s).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}):"-"}function R(s){E.value=s,m.value=!0}function S(s){g.value=s,u.value="",c.value=!0}async function N(){try{await a.deleteExpense(E.value.id),m.value=!1,d.success("Expense deleted")}catch(s){d.error(s.message)}}async function _(){try{await a.approveExpenses(o.value.map(s=>s.id)),o.value=[],d.success("Expenses approved"),a.fetchExpenses()}catch(s){d.error(s.message)}}async function B(){try{if(g.value)await a.rejectExpense(g.value.id,u.value);else{for(const s of o.value)await a.rejectExpense(s.id,u.value);o.value=[]}c.value=!1,g.value=null,u.value="",d.success("Expense(s) rejected"),a.fetchExpenses()}catch(s){d.error(s.message)}}return I(()=>a.fetchExpenses()),(s,e)=>{const M=z("router-link");return y(),x("div",null,[i(H,{title:"Expenses",icon:"bi bi-receipt-cutoff",subtitle:"Track and manage expenses"},{default:n(()=>[i(M,{to:"/app/expenses/new",class:"btn btn-primary"},{default:n(()=>[...e[8]||(e[8]=[l("i",{class:"bi bi-plus-lg"},null,-1),b(" New Expense ",-1)])]),_:1})]),_:1}),i(G,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),tabs:j},null,8,["modelValue"]),i(J,{columns:D,data:T.value,loading:v(a).loading,selectable:v(f).isAdmin&&p.value==="pending",selectableFilter:t=>t.status==="pending",selected:o.value,"onUpdate:selected":e[1]||(e[1]=t=>o.value=t)},{"cell-status":n(({value:t})=>[i(K,{status:t},null,8,["status"])]),"cell-amount":n(({row:t})=>[l("span",Q,"â‚¹"+k(Number(t.amount).toLocaleString("en-IN")),1)]),"cell-date":n(({value:t})=>[b(k(A(t)),1)]),actions:n(({row:t})=>[l("div",W,[t.status==="pending"&&!v(f).isAdmin?(y(),x("button",{key:0,class:"btn btn-ghost btn-sm text-danger",onClick:V(U=>R(t),["stop"])},[...e[9]||(e[9]=[l("i",{class:"bi bi-trash"},null,-1)])],8,X)):C("",!0),v(f).isAdmin&&t.status==="pending"?(y(),x("button",{key:1,class:"btn btn-ghost btn-sm text-danger",onClick:V(U=>S(t),["stop"])},[...e[10]||(e[10]=[l("i",{class:"bi bi-x-circle"},null,-1)])],8,Y)):C("",!0)])]),_:1},8,["data","loading","selectable","selectableFilter","selected"]),v(f).isAdmin&&o.value.length?(y(),x("div",Z,[l("span",ee,k(o.value.length)+" selected",1),l("button",{class:"btn btn-success btn-sm",onClick:_},[...e[11]||(e[11]=[l("i",{class:"bi bi-check-lg"},null,-1),b(" Approve ",-1)])]),l("button",{class:"btn btn-danger btn-sm",onClick:e[2]||(e[2]=t=>c.value=!0)},[...e[12]||(e[12]=[l("i",{class:"bi bi-x-lg"},null,-1),b(" Reject ",-1)])])])):C("",!0),i(w,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value=t),title:"Reject Expense",size:"sm"},{footer:n(()=>[l("button",{class:"btn btn-outline",onClick:e[4]||(e[4]=t=>c.value=!1)},"Cancel"),l("button",{class:"btn btn-danger",onClick:B,disabled:!u.value.trim()},"Reject",8,se)]),default:n(()=>[l("div",te,[e[13]||(e[13]=l("label",{class:"form-label"},"Reason for rejection",-1)),F(l("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>u.value=t),class:"form-input",rows:"3",placeholder:"Enter reason..."},null,512),[[L,u.value]])])]),_:1},8,["modelValue"]),i(w,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),title:"Delete Expense",size:"sm"},{footer:n(()=>[l("button",{class:"btn btn-outline",onClick:e[6]||(e[6]=t=>m.value=!1)},"Cancel"),l("button",{class:"btn btn-danger",onClick:N},"Delete")]),default:n(()=>{var t;return[l("p",null,[e[14]||(e[14]=b("Are you sure you want to delete ",-1)),l("strong",null,k((t=E.value)==null?void 0:t.title),1),e[15]||(e[15]=b("?",-1))])]}),_:1},8,["modelValue"])])}}},me=O(le,[["__scopeId","data-v-60bffb49"]]);export{me as default};
