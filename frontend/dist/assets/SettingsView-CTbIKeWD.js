import{u as F,q as L,c as i,p as T,a as s,w,e as n,v as d,f as U,t as c,F as k,j as A,d as N,x as j,A as C,s as S,r as f,o as u,n as z}from"./index-C6ZveIad.js";import{u as H}from"./categories-Bdj8pAMs.js";import{u as I}from"./useToast-DtJ4WnZ9.js";import{P as R}from"./PageHeader-DIKsNb4s.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"settings-grid"},J={class:"card"},K={class:"card-body"},O={class:"form-group"},Q={class:"form-group"},W={class:"form-group"},X=["value"],Y=["disabled"],Z={class:"card"},ss={class:"card-body"},es={class:"form-group"},as={class:"form-group"},ts={class:"form-group"},os=["disabled"],rs={key:0,class:"card"},ls={class:"card-body"},ns={class:"category-list"},is=["onClick"],ds=["disabled"],us={key:1,class:"card"},ms={class:"card-body"},ps={key:0,class:"loading-spinner",style:{width:"24px",height:"24px"}},cs={key:1,class:"user-list"},fs={class:"user-name"},vs={class:"user-email"},bs={class:"grid-2"},ys={class:"grid-2 mt-2"},gs=["disabled"],ws={__name:"SettingsView",setup(Us){const m=F(),b=H(),l=I(),y=f(!1),g=f(!1),P=f(!1),_=f(!1),V=f([]),v=f(""),p=C({name:"",email:""}),r=C({current:"",newPw:"",confirm:""}),o=C({name:"",email:"",password:"",role:"user"});async function q(){y.value=!0;try{await m.updateProfile({name:p.name}),l.success("Profile updated")}catch(t){l.error(t.message)}finally{y.value=!1}}async function M(){if(r.newPw!==r.confirm)return l.error("Passwords do not match");g.value=!0;try{await S.updateUser(m.user.id,{password:r.newPw}),r.current="",r.newPw="",r.confirm="",l.success("Password updated")}catch(t){l.error(t.message)}finally{g.value=!1}}async function E(){try{await b.addCategory(v.value),v.value="",l.success("Category added")}catch(t){l.error(t.message)}}async function B(t){try{await b.removeCategory(t),l.success("Category removed")}catch(e){l.error(e.message)}}async function D(){_.value=!0;try{await S.addUser(o),o.name="",o.email="",o.password="",o.role="user",l.success("User added"),await x()}catch(t){l.error(t.message)}finally{_.value=!1}}async function x(){P.value=!0;try{V.value=await S.getUsers()}catch(t){console.error(t)}finally{P.value=!1}}return L(async()=>{var t,e;p.name=((t=m.user)==null?void 0:t.name)||"",p.email=((e=m.user)==null?void 0:e.email)||"",b.fetchCategories(),m.isAdmin&&x()}),(t,e)=>{var h;return u(),i("div",null,[T(R,{title:"Settings",icon:"bi bi-gear-fill",subtitle:"Manage your profile and preferences"}),s("div",G,[s("div",J,[e[14]||(e[14]=s("div",{class:"card-header"},[s("span",{class:"card-title"},"Profile")],-1)),s("div",K,[s("form",{onSubmit:w(q,["prevent"])},[s("div",O,[e[10]||(e[10]=s("label",{class:"form-label"},"Name",-1)),n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>p.name=a),type:"text",class:"form-input"},null,512),[[d,p.name]])]),s("div",Q,[e[11]||(e[11]=s("label",{class:"form-label"},"Email",-1)),n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>p.email=a),type:"email",class:"form-input",disabled:""},null,512),[[d,p.email]]),e[12]||(e[12]=s("small",{class:"text-muted"},"Email cannot be changed",-1))]),s("div",W,[e[13]||(e[13]=s("label",{class:"form-label"},"Role",-1)),s("input",{value:(h=U(m).user)==null?void 0:h.role,type:"text",class:"form-input",disabled:""},null,8,X)]),s("button",{type:"submit",class:"btn btn-primary",disabled:y.value},c(y.value?"Saving…":"Save Changes"),9,Y)],32)])]),s("div",Z,[e[18]||(e[18]=s("div",{class:"card-header"},[s("span",{class:"card-title"},"Change Password")],-1)),s("div",ss,[s("form",{onSubmit:w(M,["prevent"])},[s("div",es,[e[15]||(e[15]=s("label",{class:"form-label"},"Current Password",-1)),n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.current=a),type:"password",class:"form-input",required:""},null,512),[[d,r.current]])]),s("div",as,[e[16]||(e[16]=s("label",{class:"form-label"},"New Password",-1)),n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.newPw=a),type:"password",class:"form-input",minlength:"6",required:""},null,512),[[d,r.newPw]])]),s("div",ts,[e[17]||(e[17]=s("label",{class:"form-label"},"Confirm New Password",-1)),n(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.confirm=a),type:"password",class:"form-input",required:""},null,512),[[d,r.confirm]])]),s("button",{type:"submit",class:"btn btn-primary",disabled:g.value},c(g.value?"Updating…":"Update Password"),9,os)],32)])]),U(m).isAdmin?(u(),i("div",rs,[e[20]||(e[20]=s("div",{class:"card-header"},[s("span",{class:"card-title"},"Expense Categories")],-1)),s("div",ls,[s("div",ns,[(u(!0),i(k,null,A(U(b).categories,a=>(u(),i("div",{key:a.id,class:"category-item"},[s("span",null,c(a.name),1),s("button",{class:"btn btn-ghost btn-sm text-danger",onClick:Ps=>B(a.id)},[...e[19]||(e[19]=[s("i",{class:"bi bi-trash"},null,-1)])],8,is)]))),128))]),s("form",{onSubmit:w(E,["prevent"]),class:"add-category-form"},[n(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),type:"text",class:"form-input",placeholder:"New category name"},null,512),[[d,v.value]]),s("button",{type:"submit",class:"btn btn-outline btn-sm",disabled:!v.value.trim()},"Add",8,ds)],32)])])):N("",!0),U(m).isAdmin?(u(),i("div",us,[e[23]||(e[23]=s("div",{class:"card-header"},[s("span",{class:"card-title"},"Manage Users")],-1)),s("div",ms,[P.value?(u(),i("div",ps)):(u(),i("div",cs,[(u(!0),i(k,null,A(V.value,a=>(u(),i("div",{key:a.id,class:"user-item"},[s("div",null,[s("span",fs,c(a.name),1),s("span",vs,c(a.email),1)]),s("span",{class:z(["user-role",a.role])},c(a.role),3)]))),128))])),s("form",{onSubmit:w(D,["prevent"]),class:"add-user-form mt-4"},[e[22]||(e[22]=s("h4",{class:"form-label"},"Add User",-1)),s("div",bs,[n(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.name=a),class:"form-input",placeholder:"Name",required:""},null,512),[[d,o.name]]),n(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.email=a),type:"email",class:"form-input",placeholder:"Email",required:""},null,512),[[d,o.email]])]),s("div",ys,[n(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>o.password=a),type:"password",class:"form-input",placeholder:"Password",required:""},null,512),[[d,o.password]]),n(s("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>o.role=a),class:"form-input"},[...e[21]||(e[21]=[s("option",{value:"user"},"User",-1),s("option",{value:"admin"},"Admin",-1)])],512),[[j,o.role]])]),s("button",{type:"submit",class:"btn btn-primary btn-sm mt-3",disabled:_.value},"Add User",8,gs)],32)])])):N("",!0)])])}}},hs=$(ws,[["__scopeId","data-v-fdfcc6e9"]]);export{hs as default};
