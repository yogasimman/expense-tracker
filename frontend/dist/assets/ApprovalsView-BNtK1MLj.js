import{q as J,c as b,p as i,a,F as j,j as K,l as o,t as u,b as r,d as x,r as n,m as E,o as m,n as F,e as O,v as Q}from"./index-C6ZveIad.js";import{u as W}from"./trips-Cp0E9cWG.js";import{u as X}from"./expenses-qkkFQHoE.js";import{u as Y}from"./advances-CAoGp7m3.js";import{u as Z}from"./useToast-DtJ4WnZ9.js";import{P as ee}from"./PageHeader-DIKsNb4s.js";import{T as te}from"./TabBar-BV6PNCGJ.js";import{D as R}from"./DataTable-DtQj_e2y.js";import{S as V}from"./StatusBadge-CnPGBlg1.js";import{B as se}from"./BaseModal-CFzfHryr.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"entity-tabs"},ne=["onClick"],oe={class:"capitalize"},ie={key:0,class:"bulk-actions"},ue={class:"bulk-count"},re={class:"amount"},ce={key:0,class:"bulk-actions"},de={class:"bulk-count"},pe={class:"amount"},ve={key:0,class:"bulk-actions"},be={class:"bulk-count"},me={class:"form-group"},fe=["disabled"],ge={__name:"ApprovalsView",setup(ye){const f=W(),g=X(),y=Y(),c=Z(),T=n("trips"),l=n("pending"),A=n(!1),k=n(""),C=n(""),d=n([]),p=n([]),v=n([]),S=n(!1),_=n(!1),h=n(!1),D=[{value:"trips",label:"Trips",icon:"bi bi-airplane"},{value:"expenses",label:"Expenses",icon:"bi bi-receipt"},{value:"advances",label:"Advances",icon:"bi bi-credit-card"}],B=[{value:"",label:"All",icon:"bi bi-list-ul"},{value:"pending",label:"Pending",icon:"bi bi-hourglass-split"},{value:"approved",label:"Approved",icon:"bi bi-check-circle"},{value:"rejected",label:"Rejected",icon:"bi bi-x-circle"},{value:"finished",label:"Finished",icon:"bi bi-flag-fill"}],L=[{key:"trip_name",label:"Trip Name",sortable:!0},{key:"travel_type",label:"Type",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"created_at",label:"Created",sortable:!0}],$=[{key:"expense_title",label:"Title",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"category_name",label:"Category"},{key:"trip_name",label:"Trip"},{key:"status",label:"Status",sortable:!0},{key:"date",label:"Date",sortable:!0}],I=[{key:"amount",label:"Amount",sortable:!0},{key:"paid_through",label:"Paid Through"},{key:"reference",label:"Reference"},{key:"trip_name",label:"Trip"},{key:"status",label:"Status",sortable:!0}],U=E(()=>l.value?f.trips.filter(s=>s.status===l.value):f.trips),P=E(()=>l.value?g.expenses.filter(s=>s.status===l.value):g.expenses),M=E(()=>l.value?y.advances.filter(s=>s.status===l.value):y.advances);function N(s){return s?new Date(s).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}):"-"}function w(s){C.value=s,k.value="",A.value=!0}async function z(){try{for(const s of d.value)await f.updateStatus(s.id,"approved");d.value=[],c.success("Trips approved"),f.fetchTrips()}catch(s){c.error(s.message)}}async function q(){try{await g.approveExpenses(p.value.map(s=>s.id)),p.value=[],c.success("Expenses approved"),g.fetchExpenses()}catch(s){c.error(s.message)}}async function H(){try{await y.approveAdvances(v.value.map(s=>s.id)),v.value=[],c.success("Advances approved"),y.fetchAdvances()}catch(s){c.error(s.message)}}async function G(){try{if(C.value==="trip"){for(const s of d.value)await f.updateStatus(s.id,"rejected");d.value=[],f.fetchTrips()}else if(C.value==="expense"){for(const s of p.value)await g.rejectExpense(s.id,k.value);p.value=[],g.fetchExpenses()}else if(C.value==="advance"){for(const s of v.value)await y.rejectAdvance(s.id,k.value);v.value=[],y.fetchAdvances()}A.value=!1,c.success("Items rejected")}catch(s){c.error(s.message)}}return J(async()=>{S.value=!0,_.value=!0,h.value=!0,await Promise.all([f.fetchTrips().finally(()=>S.value=!1),g.fetchExpenses().finally(()=>_.value=!1),y.fetchAdvances().finally(()=>h.value=!1)])}),(s,t)=>(m(),b("div",null,[i(ee,{title:"Approvals",icon:"bi bi-check2-circle",subtitle:"Review and approve submissions"}),a("div",le,[(m(),b(j,null,K(D,e=>a("button",{key:e.value,class:F(["entity-tab",{active:T.value===e.value}]),onClick:ke=>T.value=e.value},[a("i",{class:F(e.icon)},null,2),r(" "+u(e.label),1)],10,ne)),64))]),i(te,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),tabs:B},null,8,["modelValue"]),T.value==="trips"?(m(),b(j,{key:0},[i(R,{columns:L,data:U.value,loading:S.value,selectable:l.value==="pending",selectableFilter:e=>e.status==="pending",onRowClick:t[1]||(t[1]=e=>s.$router.push(`/app/trips/${e.id}`)),selected:d.value,"onUpdate:selected":t[2]||(t[2]=e=>d.value=e)},{"cell-status":o(({value:e})=>[i(V,{status:e},null,8,["status"])]),"cell-travel_type":o(({value:e})=>[a("span",oe,u(e),1)]),"cell-created_at":o(({value:e})=>[r(u(N(e)),1)]),_:1},8,["data","loading","selectable","selectableFilter","selected"]),d.value.length?(m(),b("div",ie,[a("span",ue,u(d.value.length)+" trip(s)",1),a("button",{class:"btn btn-success btn-sm",onClick:z},[...t[11]||(t[11]=[a("i",{class:"bi bi-check-lg"},null,-1),r(" Approve",-1)])]),a("button",{class:"btn btn-danger btn-sm",onClick:t[3]||(t[3]=e=>w("trip"))},[...t[12]||(t[12]=[a("i",{class:"bi bi-x-lg"},null,-1),r(" Reject",-1)])])])):x("",!0)],64)):x("",!0),T.value==="expenses"?(m(),b(j,{key:1},[i(R,{columns:$,data:P.value,loading:_.value,selectable:l.value==="pending",selectableFilter:e=>e.status==="pending",selected:p.value,"onUpdate:selected":t[4]||(t[4]=e=>p.value=e)},{"cell-status":o(({value:e})=>[i(V,{status:e},null,8,["status"])]),"cell-amount":o(({row:e})=>[a("span",re,"₹"+u(Number(e.amount).toLocaleString("en-IN")),1)]),"cell-expense_date":o(({value:e})=>[r(u(N(e)),1)]),_:1},8,["data","loading","selectable","selectableFilter","selected"]),p.value.length?(m(),b("div",ce,[a("span",de,u(p.value.length)+" expense(s)",1),a("button",{class:"btn btn-success btn-sm",onClick:q},[...t[13]||(t[13]=[a("i",{class:"bi bi-check-lg"},null,-1),r(" Approve",-1)])]),a("button",{class:"btn btn-danger btn-sm",onClick:t[5]||(t[5]=e=>w("expense"))},[...t[14]||(t[14]=[a("i",{class:"bi bi-x-lg"},null,-1),r(" Reject",-1)])])])):x("",!0)],64)):x("",!0),T.value==="advances"?(m(),b(j,{key:2},[i(R,{columns:I,data:M.value,loading:h.value,selectable:l.value==="pending",selectableFilter:e=>e.status==="pending",selected:v.value,"onUpdate:selected":t[6]||(t[6]=e=>v.value=e)},{"cell-status":o(({value:e})=>[i(V,{status:e},null,8,["status"])]),"cell-amount":o(({row:e})=>[a("span",pe,"₹"+u(Number(e.amount).toLocaleString("en-IN")),1)]),_:1},8,["data","loading","selectable","selectableFilter","selected"]),v.value.length?(m(),b("div",ve,[a("span",be,u(v.value.length)+" advance(s)",1),a("button",{class:"btn btn-success btn-sm",onClick:H},[...t[15]||(t[15]=[a("i",{class:"bi bi-check-lg"},null,-1),r(" Approve",-1)])]),a("button",{class:"btn btn-danger btn-sm",onClick:t[7]||(t[7]=e=>w("advance"))},[...t[16]||(t[16]=[a("i",{class:"bi bi-x-lg"},null,-1),r(" Reject",-1)])])])):x("",!0)],64)):x("",!0),i(se,{modelValue:A.value,"onUpdate:modelValue":t[10]||(t[10]=e=>A.value=e),title:"Reject Items",size:"sm"},{footer:o(()=>[a("button",{class:"btn btn-outline",onClick:t[9]||(t[9]=e=>A.value=!1)},"Cancel"),a("button",{class:"btn btn-danger",onClick:G,disabled:!k.value.trim()},"Reject",8,fe)]),default:o(()=>[a("div",me,[t[17]||(t[17]=a("label",{class:"form-label"},"Reason for rejection",-1)),O(a("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>k.value=e),class:"form-input",rows:"3",placeholder:"Enter reason..."},null,512),[[Q,k.value]])])]),_:1},8,["modelValue"])]))}},Ve=ae(ge,[["__scopeId","data-v-e3d1d9b2"]]);export{Ve as default};
