import{u as H,q as G,c as a,p,l as u,a as t,f as g,d as C,F as J,j as K,t as r,b as k,r as v,m as y,g as O,i as Q,o,w as x,n as W,e as X,v as Y}from"./index-C6ZveIad.js";import{u as Z}from"./trips-Cp0E9cWG.js";import{u as ee}from"./useToast-DtJ4WnZ9.js";import{P as te}from"./PageHeader-DIKsNb4s.js";import{T as se}from"./TabBar-BV6PNCGJ.js";import{B as R}from"./BaseModal-CFzfHryr.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"table-card"},ae={key:0,class:"loading-center"},oe={key:1,class:"trips-table"},ie={key:0,class:"col-check"},ue=["checked","indeterminate"],re=["onClick"],de=["checked","onChange","disabled"],ce={class:"fw-500"},pe={class:"capitalize"},ve={class:"text-muted"},be={class:"row-actions"},me=["onClick"],fe={key:2,class:"empty-state"},ge={key:0,class:"bulk-actions"},ke={class:"bulk-count"},ye={class:"form-group"},Te=["disabled"],he={__name:"TripsView",setup(Ce){const _=O(),i=Z(),T=H(),d=ee(),c=v(""),n=v([]),b=v(!1),m=v(!1),h=v(""),w=v(null),$=[{value:"",label:"All",icon:"bi bi-list-ul"},{value:"pending",label:"Pending",icon:"bi bi-hourglass-split"},{value:"approved",label:"Approved",icon:"bi bi-check-circle"},{value:"rejected",label:"Rejected",icon:"bi bi-x-circle"},{value:"finished",label:"Finished",icon:"bi bi-flag-fill"}],A=y(()=>c.value?i.trips.filter(s=>s.status===c.value):i.trips),V=y(()=>new Set(n.value.map(s=>s.id))),f=y(()=>A.value.filter(s=>s.status==="pending")),j=y(()=>f.value.length>0&&f.value.every(s=>V.value.has(s.id))),M=y(()=>{const s=f.value.filter(e=>V.value.has(e.id));return s.length>0&&s.length<f.value.length});function N(s){return V.value.has(s.id)}function B(s){N(s)?n.value=n.value.filter(e=>e.id!==s.id):n.value=[...n.value,s]}function z(){j.value?n.value=[]:n.value=[...f.value]}function U(s){if(!s)return"status-pending";const e=s.toLowerCase();return e==="approved"?"status-approved":e==="rejected"?"status-rejected":e==="finished"?"status-finished":"status-pending"}function F(s){return s?new Date(s).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}):"-"}function I(s){_.push(`/app/trips/${s.id}`)}function L(s){w.value=s,m.value=!0}async function P(){try{await i.deleteTrip(w.value.id),m.value=!1,d.success("Trip deleted")}catch(s){d.error(s.message)}}async function E(){try{for(const s of n.value)await i.updateStatus(s.id,"approved");n.value=[],d.success("Trips approved"),i.fetchTrips()}catch(s){d.error(s.message)}}async function q(){try{for(const s of n.value)await i.updateStatus(s.id,"rejected");n.value=[],b.value=!1,h.value="",d.success("Trips rejected"),i.fetchTrips()}catch(s){d.error(s.message)}}return G(()=>{i.fetchTrips()}),(s,e)=>{const S=Q("router-link");return o(),a("div",null,[p(te,{title:"Trips",icon:"bi bi-airplane-fill",subtitle:"Manage your business trips"},{default:u(()=>[p(S,{to:"/app/trips/new",class:"btn btn-primary"},{default:u(()=>[...e[9]||(e[9]=[t("i",{class:"bi bi-plus-lg"},null,-1),k(" New Trip ",-1)])]),_:1})]),_:1}),p(se,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),tabs:$},null,8,["modelValue"]),t("div",ne,[g(i).loading?(o(),a("div",ae,[...e[10]||(e[10]=[t("div",{class:"spinner"},null,-1)])])):A.value.length?(o(),a("table",oe,[t("thead",null,[t("tr",null,[g(T).isAdmin&&c.value==="pending"?(o(),a("th",ie,[t("input",{type:"checkbox",checked:j.value,indeterminate:M.value,onChange:z},null,40,ue)])):C("",!0),e[11]||(e[11]=t("th",null,"Submitter",-1)),e[12]||(e[12]=t("th",null,"Trip Name",-1)),e[13]||(e[13]=t("th",null,"Travel Type",-1)),e[14]||(e[14]=t("th",null,"Status",-1)),e[15]||(e[15]=t("th",null,"Created",-1)),e[16]||(e[16]=t("th",null,"Actions",-1))])]),t("tbody",null,[(o(!0),a(J,null,K(A.value,l=>(o(),a("tr",{key:l.id,onClick:D=>I(l),class:"trip-row"},[g(T).isAdmin&&c.value==="pending"?(o(),a("td",{key:0,class:"col-check",onClick:e[1]||(e[1]=x(()=>{},["stop"]))},[t("input",{type:"checkbox",checked:N(l),onChange:D=>B(l),disabled:l.status!=="pending"},null,40,de)])):C("",!0),t("td",null,r(l.user_name||l.submitter||"N/A"),1),t("td",ce,r(l.trip_name||l.tripName||"N/A"),1),t("td",pe,r(l.travel_type||l.travelType||"N/A"),1),t("td",null,[t("span",{class:W(["status-pill",U(l.status)])},r(l.status||"N/A"),3)]),t("td",ve,r(F(l.created_at)),1),t("td",{onClick:e[2]||(e[2]=x(()=>{},["stop"]))},[t("div",be,[p(S,{to:`/app/trips/${l.id}`,class:"btn btn-ghost btn-sm"},{default:u(()=>[...e[17]||(e[17]=[t("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["to"]),l.status==="pending"&&!g(T).isAdmin?(o(),a("button",{key:0,class:"btn btn-ghost btn-sm text-danger",onClick:x(D=>L(l),["stop"])},[...e[18]||(e[18]=[t("i",{class:"bi bi-trash"},null,-1)])],8,me)):C("",!0)])])],8,re))),128))])])):(o(),a("div",fe,[...e[19]||(e[19]=[t("i",{class:"bi bi-inbox"},null,-1),t("p",null,"No trips found",-1)])]))]),g(T).isAdmin&&n.value.length?(o(),a("div",ge,[t("span",ke,r(n.value.length)+" selected",1),t("button",{class:"btn btn-success btn-sm",onClick:E},[...e[20]||(e[20]=[t("i",{class:"bi bi-check-lg"},null,-1),k(" Approve ",-1)])]),t("button",{class:"btn btn-danger btn-sm",onClick:e[3]||(e[3]=l=>b.value=!0)},[...e[21]||(e[21]=[t("i",{class:"bi bi-x-lg"},null,-1),k(" Reject ",-1)])])])):C("",!0),p(R,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=l=>b.value=l),title:"Reject Trips",size:"sm"},{footer:u(()=>[t("button",{class:"btn btn-outline",onClick:e[5]||(e[5]=l=>b.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",onClick:q,disabled:!h.value.trim()},"Reject",8,Te)]),default:u(()=>[t("div",ye,[e[22]||(e[22]=t("label",{class:"form-label"},"Reason for rejection",-1)),X(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),class:"form-input",rows:"3",placeholder:"Enter reason..."},null,512),[[Y,h.value]])])]),_:1},8,["modelValue"]),p(R,{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=l=>m.value=l),title:"Delete Trip",size:"sm"},{footer:u(()=>[t("button",{class:"btn btn-outline",onClick:e[7]||(e[7]=l=>m.value=!1)},"Cancel"),t("button",{class:"btn btn-danger",onClick:P},"Delete")]),default:u(()=>{var l;return[t("p",null,[e[23]||(e[23]=k("Are you sure you want to delete ",-1)),t("strong",null,r((l=w.value)==null?void 0:l.trip_name),1),e[24]||(e[24]=k("? This will also remove associated expenses and advances.",-1))])]}),_:1},8,["modelValue"])])}}},De=le(he,[["__scopeId","data-v-97064572"]]);export{De as default};
